!function(t,e,s,i){function a(){this.opts=t.extend(r,ylc.defaults),this.premium=t.extend({},u)}var n="ylc",o="plugin_"+n,r={app_id:"",render:!0,display_login:!0,user_info:{user_id:null,user_name:null,user_email:null,gravatar:null,user_type:null,avatar_type:null,avatar_image:null,current_page:null,user_ip:null},styles:{bg_color:"#009EDB",x_pos:"right",y_pos:"bottom",border_radius:"5px 5px 0 0",popup_width:370,btn_width:260,btn_height:0,btn_type:"classic",form_width:260,animation_type:"bounceIn",autoplay:!0,autoplay_delay:1e3}},_=null,u={end_chat_frontend:function(t){if(t){var e=new Date;this.trigger_premium("save_user_data",this.data.user.conversation_id,!0,e.getTime(),!0)}},premium_frontend:function(){var e=this,i=!1,a=!1,n=!1;if(t(s).on("click","#YLC_send_btn",function(s){if(i)return!1;e.display_ntf(e.strings.msg.sending+"...","sending ","#YLC_offline_ntf");var a=t("#YLC_popup_form").serializeArray(),n=a.length-1;return t.each(a,function(s,a){if(e.data.current_form[a.name]=a.value,!a.value)return e.display_ntf(e.strings.msg.field_empty,"error","#YLC_offline_ntf"),!1;if("email"===a.name){if(!e.validate_email(a.value))return e.display_ntf(e.strings.msg.invalid_email,"error","#YLC_offline_ntf"),!1}else if("name"===a.name&&!e.validate_username(a.value))return e.display_ntf(e.strings.msg.invalid_username,"error","#YLC_offline_ntf"),!1;if(s===n){i=!0;var o=t("#YLC_popup_form").serialize()+"&vendor_id="+ylc.active_vendor.vendor_id;e.post("ylc_ajax_callback","offline_form",o,function(t){i=!1,t.error?e.display_ntf(t.error,"error","#YLC_offline_ntf"):t.warn?(e.display_ntf(t.warn,"success","#YLC_offline_ntf"),setTimeout(function(){e.clean_ntf(),e.minimize()},4e3)):(e.display_ntf(t.msg,"success","#YLC_offline_ntf"),setTimeout(function(){e.clean_ntf(),e.minimize()},2e3))})}}),!1}),t(s).on("mouseenter","#YLC_send_btn",function(){t(this).css("background-color",e.data.primary_hover)}),t(s).on("mouseleave","#YLC_send_btn",function(){t(this).css("background-color",e.opts.styles.bg_color)}),t(s).on("click","#YLC_good_btn, #YLC_bad_btn",function(s){if(a)return!1;a=!0,e.display_ntf(e.strings.msg.sending+"...","sending","#YLC_end_chat_ntf");var i="YLC_good_btn"===t(this).attr("id")?"good":"bad",n=t("#YLC_request_chat").is(":checked")?1:0;return e.post("ylc_ajax_callback","chat_evaluation",{conversation_id:e.data.user.conversation_id,evaluation:i,receive_copy:n,user_email:e.data.user.user_email,chat_with:e.data.user.chat_with},function(){a=!1}),e.minimize(),!1}),t(s).on("click","#YLC_chat_request",function(t){if(n)return!1;n=!0,e.display_ntf(e.strings.msg.sending+"...","sending","#YLC_end_chat_ntf");var s="",i=1;return e.post("ylc_ajax_callback","chat_evaluation",{conversation_id:e.data.user.conversation_id,evaluation:s,receive_copy:i,user_email:e.data.user.user_email,chat_with:e.data.user.chat_with},function(){n=!1}),e.minimize(),!1}),"round"==this.opts.styles.btn_type){var o=this.opts.styles.btn_width/2;t("#YLC_chat_btn.btn-round").css({color:this.data.primary_fg,"background-color":this.opts.styles.bg_color,width:this.opts.styles.btn_width+"px",height:this.opts.styles.btn_width+"px","-webkit-border-radius":o+"px","-moz-border-radius":o+"px","border-radius":o+"px",right:"right"===this.opts.styles.x_pos?"20px":"auto",left:"right"===this.opts.styles.x_pos?"auto":"20px",top:"top"===this.opts.styles.y_pos?"20px":"auto",bottom:"top"===this.opts.styles.y_pos?"auto":"20px"}),t("#YLC_chat_btn .chat-ico.chat").css({width:this.opts.styles.btn_width+"px"}),t("#YLC_chat_btn div").css({"line-height":this.opts.styles.btn_width+"px"})}else t("#YLC_chat_btn").css({color:this.data.primary_fg,"background-color":this.opts.styles.bg_color,width:this.opts.styles.btn_width+"px","-webkit-border-radius":this.opts.styles.border_radius,"-moz-border-radius":this.opts.styles.border_radius,"border-radius":this.opts.styles.border_radius,right:"right"===this.opts.styles.x_pos?"20px":"auto",left:"right"===this.opts.styles.x_pos?"auto":"20px",top:"top"===this.opts.styles.y_pos?"0":"auto",bottom:"top"===this.opts.styles.y_pos?"auto":"0"});t("#YLC_chat").css({"-webkit-border-radius":this.opts.styles.border_radius,"-moz-border-radius":this.opts.styles.border_radius,"border-radius":this.opts.styles.border_radius,right:"right"===this.opts.styles.x_pos?"40px":"auto",left:"right"===this.opts.styles.x_pos?"auto":"40px",top:"top"===this.opts.styles.y_pos?"0":"auto",bottom:"top"===this.opts.styles.y_pos?"auto":"0"}),t("#YLC_chat_header").css({color:this.data.primary_fg,"background-color":this.opts.styles.bg_color}),t(".chat-form-btn").css({color:this.data.primary_fg,"background-color":this.opts.styles.bg_color}),"bottom"!==this.opts.styles.y_pos&&t(".chat-body").css({"-webkit-border-radius":this.opts.styles.border_radius,"-moz-border-radius":this.opts.styles.border_radius,"border-radius":this.opts.styles.border_radius})},chat_duration:function(t,e){if(""==e||""==t)return"00:00:00";var s=.001*(e-t)>>0,i=s/60>>0,a=i/60>>0;return a%=60,i%=60,s%=60,a=10>a?"0"+a:a,i=10>i?"0"+i:i,s=10>s?"0"+s:s,a+":"+i+":"+s},save_user_data:function(e,s,i,a,n){var o=this;this.data.ref_cnv.child(e).once("value",function(r){var _=null!==r.val(),u=r.val();if(!_)return void(n&&n({}));var l=u.user_id,c=o.trigger_premium("chat_duration",u.accepted_at,i);o.data.ref_users.child(l).once("value",function(i){var r=i.val();r.created_at=u.created_at,r.evaluation=u.evaluation,r.duration=c,r.receive_copy=u.receive_copy,r.send_email=a,o.data.ref_msgs.once("value",function(i){var a=i.val(),_=a?Object.keys(a).length:0,u=0,c={};a?t.each(a,function(t,i){u+=1,i.conversation_id===e&&(c[t]=i,s&&o.data.ref_msgs.child(t).remove()),_===u&&(r.msgs=c,o.post("ylc_ajax_callback","save_chat",r,function(t){n&&n(t)}))}):n&&n({}),s&&(o.data.ref_users.child(l).remove(),o.data.ref_cnv.child(e).remove())})})})},set_avatar_premium:function(t,e){if("admin"!=t)return"https://www.gravatar.com/avatar/"+e.gravatar+".jpg?s=60&d="+ylc.default_user_avatar;switch(e.avatar_type){case"gravatar":return"https://www.gravatar.com/avatar/"+e.gravatar+".jpg?s=60&d="+ylc.default_admin_avatar;case"image":return e.avatar_image;default:return""!=ylc.company_avatar?ylc.company_avatar:this.data.assets_url+"/images/default-avatar-"+t+".png"}},logged_users_auth:function(){""!=this.opts.user_info.user_name&&""!=this.opts.user_info.user_email&&(t("#YLC_field_name").val(this.opts.user_info.user_name),t("#YLC_msg_name").val(this.opts.user_info.user_name),t("#YLC_field_email").val(this.opts.user_info.user_email),t("#YLC_msg_email").val(this.opts.user_info.user_email))},autoplay:function(){this.opts.styles.autoplay_delay>0&&setTimeout(function(){t("#YLC_chat_btn").click()},this.opts.styles.autoplay_delay)}};a.prototype={init:function(){this.data={auth:null,ref:null,is_mobile:!1,active_user_id:0,mode:"offline",logged:!1,assets_url:ylc.plugin_url,animation_delay:1e3,show_delay:1e3,guest_prefix:"Guest-",primary_fg:null,primary_hover:null,popup_status:"close",user:{},current_form:{},online_ops:{}},this.strings=ylc.strings,this.objs={btn:null,popup:null,popup_header:null,cnv:null};var t=this;this.trigger_premium("logged_users_auth"),this.trigger_premium("premium_frontend"),/Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini/i.test(navigator.userAgent)&&(this.data.is_mobile=!0),this.post("ylc_ajax_callback","get_token",{},function(e){e.error||(t.data.auth_token=e.token,t.render_chat(),t.trigger_premium("autoplay"))})},auth:function(t){return this.opts.app_id?(null==this.data.ref&&(this.data.ref=new Firebase("https://"+this.opts.app_id+".firebaseIO.com"),this.data.ref_conn=new Firebase("https://"+this.opts.app_id+".firebaseIO.com/.info/connected"),this.data.ref_cnv=new Firebase("https://"+this.opts.app_id+".firebaseIO.com/chat_sessions"),this.data.ref_msgs=new Firebase("https://"+this.opts.app_id+".firebaseIO.com/chat_messages"),this.data.ref_users=new Firebase("https://"+this.opts.app_id+".firebaseIO.com/chat_users")),void(this.opts.display_login?this.login(!1,t):this.login(!0,t))):void console.error("App ID not provided")},login:function(e,s){var a=this;this.manage_connections(),this.data._new_user=e,this.data.auth=this.data.ref.authWithCustomToken(this.data.auth_token,function(e){e?(console.error(e.code,e.message),a.display_ntf(a.strings.msg.conn_err,"error","#YLC_login_ntf")):(a.data.logged=!0,a.data.ref_users.once("value",function(e){var n=e.val(),o=0,r=!1,u=0,l=!1,c=!1;if(null!==n){var d=Object.keys(n).length;t.each(n,function(t,e){u++,e&&("operator"==e.user_type&&"online"===e.status?a.valid_operator(e.vendor_id)&&(a.data.online_ops[e.user_id]=e):"operator"!=e.user_type&&(e.user_name!==i&&e.user_id!=a.opts.user_info.user_id&&o++,e.user_email!==i&&a.data.current_form.user_email!==i&&(e.user_email!=a.data.current_form.user_email||ylc.frontend_op_access||(e.user_ip==a.opts.user_info.user_ip?"online"===e.status&&e.user_id!=a.opts.user_info.user_id?l=!0:c=e.conversation_id:l=!0)))),l?a.display_ntf(a.strings.msg.already_logged,"error","#YLC_login_ntf"):u===d&&(a.total_online_ops()||c?"operator"==a.opts.user_info.user_type||o<ylc.max_guests||0==ylc.max_guests?(null!=_&&clearInterval(_),a.opts.display_login?a.show_login():a.show_cnv(!0)):(r=!0,a.show_offline(!0)):a.show_offline(),a.check_user(a.opts.user_info.user_id,r,c))})}else a.show_offline(),a.check_user(a.opts.user_info.user_id,!1);s&&s(r)}))})},logout:function(s){var i=this;this.data.user.user_id&&(i.data.ref_user.off(),i.data.ref_users.off(),i.data.ref_msgs.off()),t(".chat-body").hide(),t("#YLC_end_chat").show(),ylc.is_premium?i.trigger_premium("end_chat_frontend",s):(s&&i.clear_user_data(i.data.user.conversation_id),setTimeout(function(){i.be_offline(),i.minimize()},2e3)),i.objs.popup_header.click(function(){i.minimize(),i.objs.popup_header.off("click")}),t(e).trigger("resize")},be_offline:function(){this.data.mode="offline",this.data.ref_user&&(this.data.ref_user.child("status").set("offline"),this.data.ref_user.child("last_online").set(Firebase.ServerValue.TIMESTAMP)),this.check_mode(!0)},check_mode:function(e){var s=this.data.mode;if(e)this.show_connecting(),this.data.mode="offline";else if(this.total_online_ops())"offline"===s&&(t("#YLC_cnv_reply").removeClass("chat-disabled").removeAttr("disabled"),this.clean_ntf()),this.data.mode=this.opts.display_login&&"online"!=s?"login":"online";else{switch(s){case"login":this.show_offline();break;case"online":ylc.is_premium||(this.opts.display_login?(t("#YLC_cnv_reply").addClass("chat-disabled").attr("disabled","disabled"),this.display_ntf(this.strings.msg.no_op+"!","error","#YLC_popup_ntf")):this.show_offline())}this.data.mode="offline"}},show_offline:function(s){var a=this;this.data.mode="offline",this.allow_chatbox()&&(a.objs.popup.parent().removeClass().addClass("chat-offline"),t(".chat-body").hide(),t("#YLC_offline .chat-lead").hide(),t("#YLC_offline").show(),s?(ylc.show_busy_form||t("#YLC_popup_form").hide(),t("#YLC_offline .chat-lead.op-busy").show(),null!=_&&clearInterval(_),_=setInterval(function(){a.data.ref_users.once("value",function(e){var s=e.val(),n=0;null!==s&&t.each(s,function(t,e){e&&e.user_name!==i&&"operator"!=e.user_type&&e.user_id!=a.opts.user_info.user_id&&n++}),n<ylc.max_guests&&(a.opts.display_login?a.login(!1):a.login(!0))})},3e4)):t("#YLC_offline .chat-lead.op-offline").show(),t(e).trigger("resize"))},show_connecting:function(){t(".chat-body").hide(),t("#YLC_connecting").show()},show_login:function(){var s=this;this.allow_chatbox()&&(this.opts.display_login&&this.total_online_ops()&&this.objs.popup?(this.data.mode="login",this.objs.popup.parent().removeClass().addClass("chat-login"),t(".chat-body").hide(),t("#YLC_login").show(),t(e).trigger("resize"),t("#YLC_login_btn").hover(function(){t(this).css("background-color",s.data.primary_hover)},function(){t(this).css("background-color",s.opts.styles.bg_color)}).click(function(){s.send_login_form()}),t("#YLC_login_form").keydown(function(t){13!=t.keyCode||t.shiftKey||(t.preventDefault(),s.send_login_form())})):"online"===s.data.mode?this.show_cnv():this.show_offline())},send_login_form:function(){var e=this;this.display_ntf(this.strings.msg.connecting+"...","sending","#YLC_login_ntf");var s=t("#YLC_login_form").serializeArray(),i=s.length-1;t.each(s,function(t,s){if(e.data.current_form[s.name]=s.value,!s.value)return e.display_ntf(e.strings.msg.field_empty,"error","#YLC_login_ntf"),!1;if("user_email"===s.name){if(!e.validate_email(s.value))return e.display_ntf(e.strings.msg.invalid_email,"error","#YLC_login_ntf"),!1;e.data.current_form.gravatar=e.md5(s.value)}else if(!e.validate_username(s.value))return e.display_ntf(e.strings.msg.invalid_username,"error","#YLC_login_ntf"),!1;t===i&&setTimeout(function(){e.login(!0)},1e4)})},check_user:function(t,e,s){var i=this;this.data.ref_user=this.data.ref_users.child(t),e?this.data.ref_user.child("status").set("wait"):(this.data.ref_user.once("value",function(e){var a=e.val();a||(a={}),i.get_user(t,a,s)}),this.data.ref_user.child("chat_with").on("value",function(t){var e=t.val();null!=e&&(i.data.user.chat_with=e)})),this.data.ref_users.on("child_removed",function(e){var s=e.val();s&&t===s.user_id&&i.logout()})},get_user:function(t,e,s,i){var a=this;if(e.user_id)this.data.user=e,this.data.ref_user.child("status").set("online"),this.data.ref_user.child("user_ip").set(a.opts.user_info.user_ip),this.data.ref_user.child("current_page").set(a.opts.user_info.current_page),this.data.ref_user.child("vendor_id").set(ylc.active_vendor.vendor_id),this.data.ref_user.child("vendor_name").set(ylc.active_vendor.vendor_name),this.data.ref_user.child("chat_with").set("free"),this.total_online_ops()?this.show_cnv():this.show_offline(),this.manage_connections(),a.listen_users(),i&&i();else if(this.data._new_user===!0){var n=this.data.ref_cnv.push({user_id:t,created_at:Firebase.ServerValue.TIMESTAMP,accepted_at:"",evaluation:"",user_type:"visitor",receive_copy:!1}),o={user_id:t,conversation_id:n.key(),last_online:"",is_mobile:this.data.is_mobile,chat_with:"free",status:"online",vendor_id:ylc.active_vendor.vendor_id,vendor_name:ylc.active_vendor.vendor_name};for(var r in this.opts.user_info)o[r]=this.opts.user_info[r];for(var _ in this.data.current_form)o[_]=this.data.current_form[_];o.user_name||(o.user_email?o.user_name=o.user_email.substring(0,o.user_email.indexOf("@")):o.user_name=this.data.guest_prefix+this.random_id(1e3,5e3)),this.data.user=o,this.data.ref_user.set(o,function(t){if(!t&&(a.show_cnv(),a.manage_connections(),a.listen_users(),s))if(ylc.is_premium){var e=new Date;a.trigger_premium("save_user_data",s,!0,e.getTime(),!1)}else a.clear_user_data(s);i&&i()})}else a.listen_users()},show_cnv:function(s){var i=this;this.data.mode="online",this.allow_chatbox()&&(this.objs.popup.parent().removeClass().addClass("chat-online"),t(".chat-body").hide(),t("#YLC_chat_body").show(),this.objs.cnv=t("#YLC_cnv"),s?setTimeout(function(){t("#YLC_cnv_reply").focus().autosize({append:""}).trigger("autosize.resize")},this.data.animation_delay):t("#YLC_cnv_reply").focus().autosize({append:""}).trigger("autosize.resize"),t(e).trigger("resize"),this.listen_msgs(),t("#YLC_tool_end_chat").click(function(){i.push_msg("-- "+i.strings.msg.close_msg_user+" --"),i.data.ref_cnv.child(i.data.user.conversation_id).child("status").set("closed"),i.logout(!0)}),this.manage_reply_box())},listen_users:function(){var e=this;this.data.last_changed_id=null,this.data.ref_users.once("value",function(s){var i=s.val(),a=0;if(null!==i){var n=Object.keys(i).length;e.data.online_ops={},t.each(i,function(t,s){a+=1,s&&e.valid_operator(s.vendor_id)&&"operator"===s.user_type&&("online"===s.status?e.data.online_ops[s.user_id]=s:delete e.data.online_ops[s.user_id]),a===n&&(e.check_mode(),e.listen_new_users())})}})},listen_new_users:function(e){var s=this;this.data.ref_users.on("value",function(e){var i=e.val();t.each(i,function(t,e){s.update_user(e)})})},update_user:function(t,e){(!t||t.user_id)&&(t&&(t.conversation_id?("operator"===t.user_type&&("online"===t.status?this.data.online_ops[t.user_id]=t:delete this.data.online_ops[t.user_id]),this.check_mode()):this.clean_user_data(t.user_id)),this.data.last_changed_id=e)},clean_user_data:function(e){var s=this,i=this.data.ref_users.child(e);i.once("value",function(a){var n=a.val();i.remove(),n.conversation_id&&s.ref_cnv.child(n.conversation_id),s.data.ref_msgs.once("value",function(i){var a=i.val();a&&t.each(a,function(t,i){i.user_id===e&&s.data.ref_msgs.child(t).remove()})})})},set_avatar:function(t,e){return t="operator"==t?"admin":"user",ylc.is_premium?this.trigger_premium("set_avatar_premium",t,e):this.data.assets_url+"/images/default-avatar-"+t+".png"},time:function(t,e){return this.strings.time[t]&&this.strings.time[t].replace(/%d/i,Math.abs(Math.round(e)))},timeago:function(t){if(!t)return"";var e=new Date,s=.001*(e.getTime()-t)>>0,i=s/60,a=i/60,n=a/24,o=n/365;return(45>s&&this.time("seconds",s)||90>s&&this.time("minute",1)||45>i&&this.time("minutes",i)||90>i&&this.time("hour",1)||24>a&&this.time("hours",a)||42>a&&this.time("day",1)||30>n&&this.time("days",n)||45>n&&this.time("month",1)||365>n&&this.time("months",n/30)||1.5>o&&this.time("year",1)||this.time("years",o))+" "+this.strings.time.suffix},listen_msgs:function(){var e=this;this.data.ref_msgs.off(),this.data.ref_msgs.once("value",function(s){var i=s.val(),a=i?Object.keys(i).length:0,n=1;i?t.each(i,function(t,s){e.data.user.conversation_id==s.conversation_id&&(s.id=t,e.add_msg(s)),s.first_load=!0,a==n&&e.listen_new_msgs(t),n+=1}):e.listen_new_msgs()})},listen_new_msgs:function(t){var e=this,s=t?e.data.ref_msgs.startAt(null,t):e.data.ref_msgs,i=!0;t||(i=!1),s.on("child_added",function(t){var s=t.val();s.id=t.key(),e.data.user.conversation_id==s.conversation_id&&(i||e.add_msg(s)),i||e.show_popup(),i=!1})},add_msg:function(t){var e=new Date,s=new Date(t.msg_time),i=s.getHours()+":"+(s.getMinutes()<10?"0":"")+s.getMinutes(),a=this.sanitize_msg(t.msg),n=s.toDateString()==e.toDateString()?i:s.getUTCDate()+" "+this.strings.months_short[s.getUTCMonth()]+", "+i;if(this.objs.cnv.find(".chat-welc").hide(),this.objs.cnv){var o=t.user_id==this.data.user.user_id?" chat-you":"",r=s.getUTCDate()+" "+this.strings.months[s.getUTCMonth()]+" "+s.getUTCFullYear()+" "+i,_=this.set_avatar(t.user_type,{gravatar:t.gravatar,avatar_type:t.avatar_type,avatar_image:t.avatar_image});this.objs.cnv.append('<div id="YLC_msg_'+t.id+'" class="chat-cnv-line'+o+'"><div title="'+r+'" class="chat-cnv-time">'+n+'</div><div class="chat-avatar"><img src="'+_+'" /></div><div class="chat-cnv-msg"><div class="chat-cnv-author">'+t.user_name+"</div>"+a+'</div></div><div class="chat-clear"></div>').scrollTop(this.objs.cnv.prop("scrollHeight"))}},sanitize_msg:function(t){var e,s,i,a,n,o={"&":"&amp;","<":"&lt;",">":"&gt;"};return e=t.replace(/[&<>]/g,function(t){return o[t]||t}),n=/\n/gim,e=e.replace(n,"<br />"),s=/(\b(https?|ftp):\/\/[-A-Z0-9+&@#\/%?=~_|!:,.;]*[-A-Z0-9+&@#\/%=~_|])/gim,e=e.replace(s,'<a href="$1" target="_blank">$1</a>'),i=/(^|[^\/])(www\.[\S]+(\b|$))/gim,e=e.replace(i,'$1<a href="http://$2" target="_blank">$2</a>'),a=/(([a-zA-Z0-9\-\_\.])+@[a-zA-Z\_]+?(\.[a-zA-Z]{2,6})+)/gim,e=e.replace(a,'<a href="mailto:$1">$1</a>')},manage_reply_box:function(e){var s=this,i=!1,a=t("#YLC_cnv_reply"),n=function(){var t=0;return function(e,s){clearTimeout(t),t=setTimeout(e,s)}}();this.data.ref_cnv.child(this.data.user.conversation_id+"/typing").remove(),a.keydown(function(e){if(13!==e.keyCode||e.shiftKey){if(!i){switch(e.keyCode){case 17:case 18:case 16:case 9:case 8:case 224:case 17:case 91:case 93:return}s.data.ref_cnv.child(s.data.user.conversation_id+"/typing/"+s.data.user.user_id).set(s.data.user.user_name),i=!0}n(function(){s.data.ref_cnv.child(s.data.user.conversation_id+"/typing/"+s.data.user.user_id).remove(),i=!1},1300)}else{e.preventDefault();var a=t(this).val();a&&(t(this).val("").trigger("autosize.resize"),s.push_msg(a),s.data.ref_cnv.child(s.data.user.conversation_id+"/typing/"+s.data.user.user_id).remove())}}),e&&this.data.ref_cnv.child(e+"/typing").off(),this.data.ref_cnv.child(this.data.user.conversation_id+"/typing").on("value",function(e){var i=0,a=e.val(),n=a?Object.keys(a).length:0;return a?void t.each(a,function(t,e){return null!=t&&t!=s.data.user.user_id?void s.display_ntf(s.strings.msg.writing.replace(/%s/i,e),"typing","#YLC_popup_ntf"):(n===i&&s.clean_ntf(),void(i+=1))}):void s.clean_ntf()}),this.objs.popup.find(".chat-cnv-reply").click(function(){a.focus()})},reload_cnv:function(e){this.data.ref_msgs.once("value",function(s){var i=(new Date,s.val()),a=(i?Object.keys(i).length:0,0);i&&t.each(i,function(t,s){s.conversation_id==e&&(s.old_msg=!0,a+=1)})})},push_msg:function(t){this.data.ref_msgs.push({user_id:this.data.user.user_id,user_type:this.data.user.user_type,conversation_id:this.data.user.conversation_id,user_name:this.data.user.user_name||this.data.user.user_email,gravatar:this.data.user.gravatar,avatar_type:this.data.user.avatar_type,avatar_image:this.data.user.avatar_image,msg:t,msg_time:Firebase.ServerValue.TIMESTAMP,vendor_id:ylc.active_vendor.vendor_id,read:!1})},get_user_data:function(t,e){this.data.ref_users.child(t).once("value",function(t){var s=t.val();e(s)})},render_chat:function(){var i=this;this.data.primary_fg=this.use_white(this.opts.styles.bg_color)?"#ffffff":"#444444",this.data.primary_hover=this.shade_color(this.opts.styles.bg_color,7),this.objs.btn=t("#YLC_chat_btn"),this.objs.btn.hover(function(){if(t(this).css("background-color",i.data.primary_hover),"round"==i.opts.styles.btn_type&&ylc.button_animation){var e=t(this).css("width","auto").width();t(this).width(i.opts.styles.btn_width).animate({width:e},250)}},function(){t(this).css("background-color",i.opts.styles.bg_color),"round"==i.opts.styles.btn_type&&ylc.button_animation&&t(this).animate({width:i.opts.styles.btn_width},250)}),this.objs.btn.click(function(){t(this).hide(),i.show_popup(),i.auth()}),setTimeout(function(){i.show_btn()},this.data.show_delay),this.show_connecting(),this.objs.popup=t("#YLC_chat"),this.objs.popup_header=t("#YLC_chat_header"),t(s).on("hover","#YLC_send_btn",function(){t(this).css("background-color",i.data.primary_hover)},function(){t(this).css("background-color",i.opts.styles.bg_color)}),t(e).resize(function(){var a=e,n=s,o=n.documentElement,r=n.getElementsByTagName("body")[0],_=(a.innerWidth||o.clientWidth||r.clientWidth,a.innerHeight||o.clientHeight||r.clientHeight),u=i.objs.popup_header.height(),l=parseInt(i.objs.popup.css("bottom"),10),c="online"===i.data.mode?320:450,d=_>c+u?c:_-u-l;t("#YLC_chat_body").css("max-height",d);var h=t(e).width();"round"==i.opts.styles.btn_type?i.objs.btn.css({width:i.opts.styles.btn_width+"px",left:"right"===i.opts.styles.x_pos?"auto":"20px",right:"left"===i.opts.styles.x_pos?"auto":"20px"}):h>480?i.objs.btn.css({width:i.opts.styles.btn_width+"px",left:"right"===i.opts.styles.x_pos?"auto":"40px",right:"left"===i.opts.styles.x_pos?"auto":"40px"}):i.objs.btn.css({width:"",left:"right"===i.opts.styles.x_pos?"auto":0,right:"left"===i.opts.styles.x_pos?"auto":0}),h>480?(i.objs.popup.css({left:"right"===i.opts.styles.x_pos?"auto":"40px",right:"left"===i.opts.styles.x_pos?"auto":"40px"}),t(".chat-body.chat-online").css("width",i.opts.styles.popup_width+"px"),t(".chat-body.chat-form").css("width",i.opts.styles.form_width+"px")):(i.objs.popup.css({left:"right"===i.opts.styles.x_pos?"auto":0,right:"left"===i.opts.styles.x_pos?"auto":0}),t(".chat-body").css("width",""))}).trigger("resize")},show_popup:function(){if("open"!=this.data.popup_status){var e=this;this.objs.popup.show(),this.animate(this.objs.popup,this.opts.styles.animation_type),setTimeout(function(){e.objs.popup_header.click(function(){e.be_offline(),e.minimize(),e.objs.popup_header.off("click")})},3e3),setTimeout(function(){switch(e.data.mode){case"online":t("#YLC_cnv_reply").focus(),e.objs.cnv.scrollTop(e.objs.cnv.prop("scrollHeight"));break;case"offline":case"login":t("#YLC_login_form .chat-line:first-child input").focus()}e.data.popup_status="open"},this.data.animation_delay)}},show_btn:function(t){this.allow_chatbox()&&(this.objs.btn.show(),this.objs.btn.find(".chat-title").html(t),this.animate(this.objs.btn,this.opts.styles.animation_type))},minimize:function(){this.data.popup_status="close",this.objs.popup&&(this.objs.popup.hide(),this.show_connecting()),this.objs.btn.show(),this.animate(this.objs.btn,this.opts.styles.animation_type)},manage_connections:function(){var t=this;this.data.ref_user&&this.data.ref_conn.on("value",function(e){if(e.val()===!0){var s=t.data.ref_user.child("connections").push(!0);s.onDisconnect().remove(),t.data.ref_user.child("status").set("online"),t.data.ref_user.child("status").onDisconnect().set("offline"),t.data.ref_user.child("last_online").onDisconnect().set(Firebase.ServerValue.TIMESTAMP),t.data.ref_cnv.child(t.data.user.conversation_id+"/typing/"+t.data.user.user_id).onDisconnect().remove()}else t.show_offline()})},post:function(e,s,i,a){t.post(ylc.ajax_url+"?action="+e+"&mode="+s,i,a,"json").fail(function(t){return console.log(s,": ",t),!1})},trigger_premium:function(t,e,s,i,a,n,o){return ylc.is_premium?this.premium[t].call(this,e,s,i,a,n,o):void 0},display_ntf:function(e,s,i){var a;switch(s){case"success":a='<i class="fa fa-check"></i> ';break;case"error":a='<i class="fa fa-exclamation-triangle"></i> ';break;case"typing":a='<i class="fa fa-pencil-square-o"></i> ';break;default:a=""}t(i).removeClass().addClass("chat-ntf chat-"+s).html(a+e).fadeIn(300)},clean_ntf:function(){t(".chat-ntf").html("").hide()},clear_user_data:function(e,s){var i=this;this.data.ref_cnv.child(e).once("value",function(a){var n=a.val();if(n){var o=n.user_id;i.data.ref_msgs.once("value",function(a){var n=a.val(),r=n?Object.keys(n).length:0,_=0;n?t.each(n,function(t,a){_+=1,a.conversation_id===e&&i.data.ref_msgs.child(t).remove(),r===_&&s&&s()}):s&&s(),i.data.ref_users.child(o).remove(),i.data.ref_cnv.child(e).remove()})}})},total_online_ops:function(){return this.data.online_ops?Object.keys(this.data.online_ops).length:0},allow_chatbox:function(){return this.opts.render?!0:!1},animate:function(s,i){t(e).trigger("resize");var a="top"===this.opts.styles.y_pos?"Down":"Up";s.addClass("chat-anim chat-"+i+a),setTimeout(function(){s.removeClass("chat-anim chat-"+i+a)},this.data.animation_delay)},shade_color:function(t,e){var s=parseInt(t.slice(1),16),i=Math.round(2.55*e),a=(s>>16)+i,n=(s>>8&255)+i,o=(255&s)+i;return"#"+(16777216+65536*(255>a?1>a?0:a:255)+256*(255>n?1>n?0:n:255)+(255>o?1>o?0:o:255)).toString(16).slice(1)},use_white:function(t){var t=t.substring(1),e=parseInt(t,16),s=e>>16&255,i=e>>8&255,a=e>>0&255,n=.2126*s+.7152*i+.0722*a;return 180>n?!0:!1},validate_email:function(t){var e=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;return e.test(t)},validate_username:function(t){var e=/^[\u0030-\u0039\u0041-\u005A\u0061-\u007A\u00C0-\u00D6\u00D8-\u00F6\u00F8-\u00FF\u0100-\u017F\u0180-\u024F\u0370-\u03FF\u0400-\u04FF\u0530-\u058F\u0590-\u05FF\u0600-\u06FF\u1100-\u11FF\u3130-\u318F\uAC00-\uD7AF\u2E80-\u2EFF\u3000-\u303F\u31C0-\u31EF\u3200-\u32FF\u3300-\u33FF\u3400-\u4DBF\u4E00-\u9FFF\uF900-\uFAFF\uFE30-\uFE4F\u0020\u002D\u002E\u0040\u005F]+$/gim;return e.test(t)},md5:function(t){function e(t,e){var s,i,a,n,o;return a=2147483648&t,n=2147483648&e,s=1073741824&t,i=1073741824&e,o=(1073741823&t)+(1073741823&e),s&i?2147483648^o^a^n:s|i?1073741824&o?3221225472^o^a^n:1073741824^o^a^n:o^a^n}function s(t,s,i,a,n,o,r){return t=e(t,e(e(s&i|~s&a,n),r)),e(t<<o|t>>>32-o,s)}function i(t,s,i,a,n,o,r){return t=e(t,e(e(s&a|i&~a,n),r)),e(t<<o|t>>>32-o,s)}function a(t,s,i,a,n,o,r){return t=e(t,e(e(s^i^a,n),r)),e(t<<o|t>>>32-o,s)}function n(t,s,i,a,n,o,r){return t=e(t,e(e(i^(s|~a),n),r)),e(t<<o|t>>>32-o,s)}function o(t){var e,s="",i="";for(e=0;3>=e;e++)i=t>>>8*e&255,i="0"+i.toString(16),s+=i.substr(i.length-2,2);return s}var r,_,u,l,c,d,h,p,f=[];for(t=function(t){t=t.replace(/\r\n/g,"\n");for(var e="",s=0;s<t.length;s++){var i=t.charCodeAt(s);128>i?e+=String.fromCharCode(i):(i>127&&2048>i?e+=String.fromCharCode(i>>6|192):(e+=String.fromCharCode(i>>12|224),e+=String.fromCharCode(i>>6&63|128)),e+=String.fromCharCode(63&i|128))}return e}(t),f=function(t){var e,s=t.length;e=s+8;for(var i=16*((e-e%64)/64+1),a=Array(i-1),n=0,o=0;s>o;)e=(o-o%4)/4,n=o%4*8,a[e]|=t.charCodeAt(o)<<n,o++;return e=(o-o%4)/4,a[e]|=128<<o%4*8,a[i-2]=s<<3,a[i-1]=s>>>29,a}(t),c=1732584193,d=4023233417,h=2562383102,p=271733878,t=0;t<f.length;t+=16)r=c,_=d,u=h,l=p,c=s(c,d,h,p,f[t+0],7,3614090360),p=s(p,c,d,h,f[t+1],12,3905402710),h=s(h,p,c,d,f[t+2],17,606105819),d=s(d,h,p,c,f[t+3],22,3250441966),c=s(c,d,h,p,f[t+4],7,4118548399),p=s(p,c,d,h,f[t+5],12,1200080426),h=s(h,p,c,d,f[t+6],17,2821735955),d=s(d,h,p,c,f[t+7],22,4249261313),c=s(c,d,h,p,f[t+8],7,1770035416),p=s(p,c,d,h,f[t+9],12,2336552879),h=s(h,p,c,d,f[t+10],17,4294925233),d=s(d,h,p,c,f[t+11],22,2304563134),c=s(c,d,h,p,f[t+12],7,1804603682),p=s(p,c,d,h,f[t+13],12,4254626195),h=s(h,p,c,d,f[t+14],17,2792965006),d=s(d,h,p,c,f[t+15],22,1236535329),c=i(c,d,h,p,f[t+1],5,4129170786),p=i(p,c,d,h,f[t+6],9,3225465664),h=i(h,p,c,d,f[t+11],14,643717713),d=i(d,h,p,c,f[t+0],20,3921069994),c=i(c,d,h,p,f[t+5],5,3593408605),p=i(p,c,d,h,f[t+10],9,38016083),h=i(h,p,c,d,f[t+15],14,3634488961),d=i(d,h,p,c,f[t+4],20,3889429448),c=i(c,d,h,p,f[t+9],5,568446438),p=i(p,c,d,h,f[t+14],9,3275163606),h=i(h,p,c,d,f[t+3],14,4107603335),d=i(d,h,p,c,f[t+8],20,1163531501),c=i(c,d,h,p,f[t+13],5,2850285829),p=i(p,c,d,h,f[t+2],9,4243563512),h=i(h,p,c,d,f[t+7],14,1735328473),d=i(d,h,p,c,f[t+12],20,2368359562),c=a(c,d,h,p,f[t+5],4,4294588738),p=a(p,c,d,h,f[t+8],11,2272392833),h=a(h,p,c,d,f[t+11],16,1839030562),d=a(d,h,p,c,f[t+14],23,4259657740),c=a(c,d,h,p,f[t+1],4,2763975236),p=a(p,c,d,h,f[t+4],11,1272893353),h=a(h,p,c,d,f[t+7],16,4139469664),d=a(d,h,p,c,f[t+10],23,3200236656),c=a(c,d,h,p,f[t+13],4,681279174),p=a(p,c,d,h,f[t+0],11,3936430074),h=a(h,p,c,d,f[t+3],16,3572445317),d=a(d,h,p,c,f[t+6],23,76029189),c=a(c,d,h,p,f[t+9],4,3654602809),p=a(p,c,d,h,f[t+12],11,3873151461),h=a(h,p,c,d,f[t+15],16,530742520),d=a(d,h,p,c,f[t+2],23,3299628645),c=n(c,d,h,p,f[t+0],6,4096336452),p=n(p,c,d,h,f[t+7],10,1126891415),h=n(h,p,c,d,f[t+14],15,2878612391),d=n(d,h,p,c,f[t+5],21,4237533241),c=n(c,d,h,p,f[t+12],6,1700485571),p=n(p,c,d,h,f[t+3],10,2399980690),h=n(h,p,c,d,f[t+10],15,4293915773),d=n(d,h,p,c,f[t+1],21,2240044497),c=n(c,d,h,p,f[t+8],6,1873313359),p=n(p,c,d,h,f[t+15],10,4264355552),h=n(h,p,c,d,f[t+6],15,2734768916),d=n(d,h,p,c,f[t+13],21,1309151649),c=n(c,d,h,p,f[t+4],6,4149444226),p=n(p,c,d,h,f[t+11],10,3174756917),h=n(h,p,c,d,f[t+2],15,718787259),d=n(d,h,p,c,f[t+9],21,3951481745),c=e(c,r),d=e(d,_),h=e(h,u),p=e(p,l);return(o(c)+o(d)+o(h)+o(p)).toLowerCase()},random_id:function(t,e){return Math.floor(Math.random()*(e-t+1))+t},valid_operator:function(t){return ylc.yith_wpv_active?ylc.yith_wpv_active&&ylc.active_vendor.vendor_id===t?!0:ylc.yith_wpv_active&&"0"===t&&!ylc.vendor_only_chat?!0:!1:!0}},t.fn[n]=function(){var t;this.data(o)instanceof a||this.data(o,new a(this)),t=this.data(o),t.el=this,t.init()},t(s).ready(function(){t("#YLC").ylc(),t('a[href="#yith-live-chat"]').click(function(e){e.preventDefault(),t("#YLC_chat_btn").click()})})}(jQuery,window,document);